@page "/icon-column-demo"
@using Microsoft.AspNetCore.Components.QuickGrid
@using QuickGridTest01.CustomColumns

<PageTitle>Icon Column Demo</PageTitle>

<div class="qg-container">
    <header class="qg-page-header">
        <h1 class="qg-page-title">Icon Column Demonstrations</h1>
        <p class="qg-page-subtitle">
            Reusable <code>IconColumn&lt;TGridItem,TValue&gt;</code> with icon/color/tooltip mappers. Refined Minimalism layout and tokens.
        </p>
    </header>

    <section class="qg-section">
        <div class="qg-section-header">
            <h2 class="qg-section-title">About the Icon Column</h2>
            <p class="qg-section-description">
                Centralizes icon display logic via mapper delegates (<code>IconMapper</code>, <code>ColorMapper</code>, <code>TooltipMapper</code>, optional value text). Sorts by the underlying value and renders a compact cell.
            </p>
        </div>
    </section>

    <section class="qg-section">
        <div class="qg-section-header">
            <h2 class="qg-section-title">Example 1: Task Status Grid</h2>
            <p class="qg-section-description">
                Icon and color indicators for status and priority. Values remain readable and sorting uses underlying values.
            </p>
        </div>
        <div class="qg-grid-container">
            <QuickGrid Items="@tasks" Class="qg-grid qg-grid-auto">
                <PropertyColumn Property="@(t => t.Id)" Title="ID" />
                <PropertyColumn Property="@(t => t.TaskName)" Title="Task" Sortable="true" />
                <IconColumn 
                    TGridItem="TaskItem" 
                    TValue="TaskStatus"
                    Property="@(t => t.Status)"
                    IconMapper="@GetStatusIcon"
                    ColorMapper="@GetStatusColor"
                    TooltipMapper="@GetStatusTooltip"
                    Title="Status"
                    Sortable="true"
                    ShowValue="true" />
                <IconColumn 
                    TGridItem="TaskItem" 
                    TValue="Priority"
                    Property="@(t => t.Priority)"
                    IconMapper="@GetPriorityIcon"
                    ColorMapper="@GetPriorityColor"
                    Title="Priority"
                    Sortable="true"
                    ShowValue="true" />
                <PropertyColumn Property="@(t => t.AssignedTo)" Title="Assigned To" />
                <PropertyColumn Property="@(t => t.DueDate)" Title="Due Date" Format="yyyy-MM-dd" />
            </QuickGrid>
        </div>
    </section>

    <section class="qg-section">
        <div class="qg-section-header">
            <h2 class="qg-section-title">Example 2: Server Health Grid</h2>
            <p class="qg-section-description">
                Icon-only health status column with tooltips for additional context.
            </p>
        </div>
        <div class="qg-grid-container">
            <QuickGrid Items="@servers" Class="qg-grid qg-grid-auto">
                <PropertyColumn Property="@(s => s.ServerName)" Title="Server" Sortable="true" />
                <IconColumn 
                    TGridItem="ServerInfo" 
                    TValue="HealthStatus"
                    Property="@(s => s.Health)"
                    IconMapper="@GetHealthIcon"
                    ColorMapper="@GetHealthColor"
                    TooltipMapper="@GetHealthTooltip"
                    Title="Health"
                    Sortable="true"
                    ShowValue="false" />
                <PropertyColumn Property="@(s => s.CpuUsage)" Title="CPU %" Format="F1" />
                <PropertyColumn Property="@(s => s.MemoryUsage)" Title="Memory %" Format="F1" />
                <PropertyColumn Property="@(s => s.LastCheck)" Title="Last Check" Format="HH:mm:ss" />
            </QuickGrid>
        </div>
    </section>
</div>

@code {
    private IQueryable<TaskItem> tasks = default!;
    private IQueryable<ServerInfo> servers = default!;

    protected override void OnInitialized()
    {
        var taskList = new List<TaskItem>
        {
            new() { Id = 1, TaskName = "Implement authentication", Status = TaskStatus.InProgress, Priority = Priority.High, AssignedTo = "Alice", DueDate = DateTime.Now.AddDays(2) },
            new() { Id = 2, TaskName = "Write unit tests", Status = TaskStatus.Completed, Priority = Priority.Medium, AssignedTo = "Bob", DueDate = DateTime.Now.AddDays(-1) },
            new() { Id = 3, TaskName = "Code review", Status = TaskStatus.Pending, Priority = Priority.Low, AssignedTo = "Charlie", DueDate = DateTime.Now.AddDays(5) },
            new() { Id = 4, TaskName = "Deploy to production", Status = TaskStatus.Blocked, Priority = Priority.High, AssignedTo = "Diana", DueDate = DateTime.Now.AddDays(1) },
            new() { Id = 5, TaskName = "Update documentation", Status = TaskStatus.InProgress, Priority = Priority.Medium, AssignedTo = "Eve", DueDate = DateTime.Now.AddDays(3) },
            new() { Id = 6, TaskName = "Fix bug #247", Status = TaskStatus.Completed, Priority = Priority.High, AssignedTo = "Frank", DueDate = DateTime.Now.AddDays(-2) },
        };
        tasks = taskList.AsQueryable();

        var serverList = new List<ServerInfo>
        {
            new() { ServerName = "web-01", Health = HealthStatus.Healthy, CpuUsage = 45.2, MemoryUsage = 62.8, LastCheck = DateTime.Now.AddMinutes(-2) },
            new() { ServerName = "web-02", Health = HealthStatus.Healthy, CpuUsage = 38.6, MemoryUsage = 58.1, LastCheck = DateTime.Now.AddMinutes(-1) },
            new() { ServerName = "db-01", Health = HealthStatus.Warning, CpuUsage = 78.3, MemoryUsage = 89.2, LastCheck = DateTime.Now.AddMinutes(-3) },
            new() { ServerName = "api-01", Health = HealthStatus.Critical, CpuUsage = 95.7, MemoryUsage = 97.4, LastCheck = DateTime.Now.AddMinutes(-5) },
            new() { ServerName = "cache-01", Health = HealthStatus.Healthy, CpuUsage = 22.1, MemoryUsage = 34.5, LastCheck = DateTime.Now.AddMinutes(-1) },
        };
        servers = serverList.AsQueryable();
    }

    // Task Status Icon Mappers
    private string GetStatusIcon(TaskStatus status) => status switch
    {
        TaskStatus.Pending => "bi bi-clock",
        TaskStatus.InProgress => "bi bi-arrow-repeat",
        TaskStatus.Completed => "bi bi-check-circle-fill",
        TaskStatus.Blocked => "bi bi-exclamation-triangle-fill",
        _ => "bi bi-question-circle"
    };

    private string GetStatusColor(TaskStatus status) => status switch
    {
        TaskStatus.Pending => "var(--color-text-tertiary)",
        TaskStatus.InProgress => "var(--color-accent-primary)",
        TaskStatus.Completed => "var(--color-success)",
        TaskStatus.Blocked => "var(--color-error)",
        _ => "var(--color-text-tertiary)"
    };

    private string GetStatusTooltip(TaskStatus status) => status switch
    {
        TaskStatus.Pending => "Waiting to start",
        TaskStatus.InProgress => "Currently in progress",
        TaskStatus.Completed => "Successfully completed",
        TaskStatus.Blocked => "Blocked by dependencies",
        _ => "Unknown status"
    };

    // Priority Icon Mappers
    private string GetPriorityIcon(Priority priority) => priority switch
    {
        Priority.Low => "bi bi-arrow-down-circle",
        Priority.Medium => "bi bi-dash-circle",
        Priority.High => "bi bi-arrow-up-circle-fill",
        _ => "bi bi-circle"
    };

    private string GetPriorityColor(Priority priority) => priority switch
    {
        Priority.Low => "var(--color-success)",
        Priority.Medium => "var(--color-warning)",
        Priority.High => "var(--color-error)",
        _ => "var(--color-text-tertiary)"
    };

    // Health Status Icon Mappers
    private string GetHealthIcon(HealthStatus health) => health switch
    {
        HealthStatus.Healthy => "bi bi-heart-fill",
        HealthStatus.Warning => "bi bi-exclamation-triangle-fill",
        HealthStatus.Critical => "bi bi-x-octagon-fill",
        _ => "bi bi-question-circle"
    };

    private string GetHealthColor(HealthStatus health) => health switch
    {
        HealthStatus.Healthy => "var(--color-success)",
        HealthStatus.Warning => "var(--color-warning)",
        HealthStatus.Critical => "var(--color-error)",
        _ => "var(--color-text-tertiary)"
    };

    private string GetHealthTooltip(HealthStatus health) => health switch
    {
        HealthStatus.Healthy => "System is operating normally",
        HealthStatus.Warning => "System needs attention",
        HealthStatus.Critical => "System requires immediate action",
        _ => "Unknown health status"
    };

    // Data Models
    public class TaskItem
    {
        public int Id { get; set; }
        public string TaskName { get; set; } = string.Empty;
        public TaskStatus Status { get; set; }
        public Priority Priority { get; set; }
        public string AssignedTo { get; set; } = string.Empty;
        public DateTime DueDate { get; set; }
    }

    public class ServerInfo
    {
        public string ServerName { get; set; } = string.Empty;
        public HealthStatus Health { get; set; }
        public double CpuUsage { get; set; }
        public double MemoryUsage { get; set; }
        public DateTime LastCheck { get; set; }
    }

    public enum TaskStatus
    {
        Pending,
        InProgress,
        Completed,
        Blocked
    }

    public enum Priority
    {
        Low,
        Medium,
        High
    }

    public enum HealthStatus
    {
        Healthy,
        Warning,
        Critical
    }
}
