@page "/dynamic-test"
@using Microsoft.AspNetCore.Components.QuickGrid
@using QuickGridTest01.CustomColumns

<PageTitle>Dynamic Column Test</PageTitle>

<h3>Minimal Dynamic Column Test</h3>

<h4>Test 1: Hardcoded DynamicColumns (No Loop)</h4>
<p>If you see a grid with data below, DynamicColumn works!</p>
<QuickGrid Items="@employees">
    <DynamicColumn TGridItem="Employee" TValue="int" PropertyPath="Id" Title="ID" />
    <DynamicColumn TGridItem="Employee" TValue="string" PropertyPath="FirstName" Title="First Name" />
    <DynamicColumn TGridItem="Employee" TValue="string" PropertyPath="LastName" Title="Last Name" />
</QuickGrid>

<h4>Test 2: PropertyColumn for Comparison</h4>
<p>This should always work (control test):</p>
<QuickGrid Items="@employees">
    <PropertyColumn Property="@(e => e.Id)" Title="ID" />
    <PropertyColumn Property="@(e => e.FirstName)" Title="First Name" />
    <PropertyColumn Property="@(e => e.LastName)" Title="Last Name" />
</QuickGrid>

<h4>Test 3: DynamicColumns in foreach Loop</h4>
<p>If Test 1 works but this doesn't, the issue is with foreach:</p>
<QuickGrid Items="@employees">
    @foreach (var def in columnDefs)
    {
        <DynamicColumn @key="def.Path" TGridItem="Employee" TValue="string" PropertyPath="@def.Path" Title="@def.Title" />
    }
</QuickGrid>

<h4>Test 4: IconColumn (Known Working)</h4>
<p>This uses a similar pattern to DynamicColumn:</p>
<QuickGrid Items="@employees">
    <IconColumn TGridItem="Employee" 
                TValue="int"
                Property="@(e => e.Id)"
                IconMapper="@(id => "bi bi-hash")"
                Title="ID"
                ShowValue="true" />
    <IconColumn TGridItem="Employee" 
                TValue="string"
                Property="@(e => e.FirstName)"
                IconMapper="@(name => "bi bi-person")"
                Title="First Name"
                ShowValue="true" />
</QuickGrid>

@code {
    private IQueryable<Employee> employees = default!;
    private (string Path, string Title)[] columnDefs = new[]
    {
        ("Id","ID"),
        ("FirstName","First Name"),
        ("LastName","Last Name")
    };

    protected override void OnInitialized()
    {
        var employeeList = new List<Employee>
        {
            new() { Id = 1, FirstName = "John", LastName = "Smith" },
            new() { Id = 2, FirstName = "Sarah", LastName = "Johnson" },
            new() { Id = 3, FirstName = "Michael", LastName = "Brown" }
        };
        employees = employeeList.AsQueryable();
    }

    public class Employee
    {
        public int Id { get; set; }
        public string FirstName { get; set; } = string.Empty;
        public string LastName { get; set; } = string.Empty;
    }
}
